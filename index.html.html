<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GS ENCURTADOR</title>
<style>
  :root{--bg:#021026;--card:#022b3a;--accent:#22d4ff}
  body{margin:0;background:radial-gradient(circle at 10% 10%, #053449 0%, var(--bg) 60%);font-family:Inter,system-ui,Arial;color:#e6f7ff;display:flex;align-items:center;justify-content:center;height:100vh}
  .container{width:min(920px,96%);display:grid;grid-template-columns:1fr 360px;gap:28px;align-items:start}
  .brand{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:28px;border-radius:16px;box-shadow:0 10px 40px rgba(2,36,63,0.6)}
  .right{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:22px;border-radius:12px}
  .star{font-size:48px;color:var(--accent);text-shadow:0 0 18px rgba(34,212,255,0.25)}
  h1{margin:8px 0 6px}
  .muted{color:#cfeffb;opacity:0.8;font-size:14px}
  label{display:block;margin-top:12px;font-size:13px}
  input[type="text"], select {width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
  button{margin-top:12px;padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;background:linear-gradient(90deg,var(--accent),#6ee7ff);color:#012;box-shadow:0 10px 30px rgba(34,212,255,0.06)}
  .output{margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:14px;word-break:break-all}
  .small{font-size:13px;opacity:0.85}
  .credits{margin-top:18px;font-size:12px;opacity:0.7}
  @media(max-width:900px){.container{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="container">
    <div class="brand">
      <div class="star">★</div>
      <h1>GS ENCURTADOR</h1>
      <div class="muted">Todos os direitos reservados — Georges Pereira</div>

      <p class="small" style="margin-top:14px">Crie links curtos com intersticial de espera (botão) ou sem espera.</p>

      <div style="margin-top:14px">
        <label>Escolha o tipo</label>
        <select id="type">
          <option value="button">Encurtar com botão (espera 15s)</option>
          <option value="simple">Encurtar simples (sem espera)</option>
        </select>

        <label>Link a ser encurtado (comece com http:// ou https://)</label>
        <input id="destination" type="text" placeholder="https://exemplo.com/pagina"/>

        <label>Tempo de espera (segundos) — só para 'button'</label>
        <input id="waitSeconds" type="text" placeholder="15" value="15"/>

        <button id="createBtn">Criar encurtador</button>

        <div class="output" id="result" style="display:none"></div>
        <div class="credits">Feito com carinho — GS ENCURTADOR</div>
      </div>
    </div>

    <div class="right">
      <h3>Status & Instruções</h3>
      <p class="small">1) Preencha o link e crie. 2) Copie o short URL (ex: https://SEU_PROJETO.web.app/r/abc123). 3) Abra o short URL em outro navegador — aparecerá o contador e o botão de redirecionamento.</p>
      <h4 style="margin-top:14px">Dicas de segurança</h4>
      <ul class="small">
        <li>Recomendado usar HTTPS no destino.</li>
        <li>Monitore seu Firestore (links maliciosos podem ser removidos manualmente).</li>
        <li>Para produção, adicione autenticação ao painel de criação se quiser controlar quem cria links.</li>
      </ul>
    </div>
  </div>

<script>
document.getElementById('createBtn').addEventListener('click', async () => {
  const dest = document.getElementById('destination').value.trim();
  const type = document.getElementById('type').value;
  let waitSeconds = parseInt(document.getElementById('waitSeconds').value, 10);
  if (!dest) return alert('Preencha o link de destino.');
  if (!/^https?:\/\//i.test(dest)) return alert('Coloque http:// ou https:// no começo do link.');
  if (isNaN(waitSeconds) || waitSeconds <= 0) waitSeconds = 15;

  const payload = { destination: dest, type, waitSeconds };

  const btn = document.getElementById('createBtn');
  btn.disabled = true;
  btn.textContent = 'Criando...';

  try {
    const res = await fetch('/api/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Erro ao criar');
    const resultEl = document.getElementById('result');
    const short = data.shortUrl || (location.origin + '/r/' + data.id);
    resultEl.style.display = 'block';
    resultEl.innerHTML = 'Link criado: <a href="' + short + '" target="_blank" rel="noopener">' + short + '</a>';
  } catch (err) {
    alert('Erro: ' + (err.message || err));
    console.error(err);
  } finally {
    btn.disabled = false;
    btn.textContent = 'Criar encurtador';
  }
});
</script>
</body>
</html>
